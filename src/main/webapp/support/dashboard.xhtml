<ui:composition template="/WEB-INF/template.xhtml"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:p="http://primefaces.org/ui">
  <ui:param name="tabIndex" value="0" />
  <ui:define name="subtitle">
    <h:form id="submenuForm">
      <h:panelGroup 
        class="ui-menu ui-menubar ui-widget ui-widget-content ui-corner-all ui-helper-clearfix">
        <span class="ui-button-text">#{ticketBean.selectedTicket.number}</span>
        <p:commandButton title="Przypisz do mnie" icon="ui-icon-plusthick"
          value="Przypisz do mnie" styleClass="float-right" update=":unassignedDataForm, :assignedDataForm, :submenuForm"
          action="#{ticketBean.assignToMe()}"  
          rendered="#{not empty ticketBean.selectedTicket and empty ticketBean.selectedTicket.assignee}" >
          </p:commandButton>
        <p:commandButton title="Przejdź do zgłoszenia" icon="ui-icon-plusthick"
          value="Przejdź do zgłoszenia" styleClass="float-right"
          action="#{loginBean.logout()}" actionListener="#{loginBean.logout()}"
          rendered="#{not empty ticketBean.selectedTicket}" />

      </h:panelGroup>
    </h:form>
  </ui:define>
  <ui:define name="page">
    <h:form id="unassignedDataForm">
      <p:dataTable id="unassignedDataTable" var="ticket" value="#{ticketUnassignedBean.partnerTickets}" rowKey="#{ticket.number}" selectionMode="single"
        selection="#{ticketBean.selectedTicket}" >
        <p:ajax event="rowSelect" update=":submenuForm" />
        <f:facet name="header">
          Lista nieprzydzielonych zgłoszeń
        </f:facet>
        <p:column headerText="Numer">
          <h:outputText value="#{ticket.number}" />
        </p:column>

        <p:column headerText="Formularz">
          <h:outputText value="#{ticket.formName}" />
        </p:column>

        <p:column headerText="Od kogo [email]">
          <h:outputText value="#{ticket.fromName} [#{ticket.fromEmail}]" />
        </p:column>

        <p:column headerText="Data zarejestrowania">
          <h:outputText value="#{ticket.date}" />
        </p:column>

        <p:column headerText="Status">
          <h:outputText value="#{ticket.status}" />
        </p:column>
      </p:dataTable>
      </h:form>
      <h:form id="assignedDataForm">
       <p:dataTable id="assignedDataTable" var="ticket" value="#{ticketAssignedBean.partnerTickets}" rowKey="#{ticket.number}" selectionMode="single"
        selection="#{ticketBean.selectedTicket}">
        <p:ajax event="rowSelect" update=":submenuForm" />
        <f:facet name="header">
          Lista obsługiwanych zgłoszeń
        </f:facet>
        <p:column headerText="Numer">
          <h:outputText value="#{ticket.number}" />
        </p:column>

        <p:column headerText="Formularz">
          <h:outputText value="#{ticket.formName}" />
        </p:column>

        <p:column headerText="Od kogo [email]">
          <h:outputText value="#{ticket.fromName} [#{ticket.fromEmail}]" />
        </p:column>

        <p:column headerText="Data zarejestrowania">
          <h:outputText value="#{ticket.date}" />
        </p:column>
        
        <p:column headerText="Odpowiedzialność">
          <h:outputText value="#{ticket.assignee}" />
        </p:column>

        <p:column headerText="Status">
          <h:outputText value="#{ticket.status}" />
        </p:column>
      </p:dataTable>
    </h:form>
  </ui:define>
</ui:composition>
